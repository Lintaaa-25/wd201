<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Todo-list</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    header {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 20px;
    }
    form {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    input[type="text"], input[type="date"] {
      padding: 5px;
      font-size: 14px;
      flex: 1;
    }
    button {
      padding: 6px 12px;
      font-size: 14px;
    }
    section {
      margin-bottom: 20px;
    }
    .badge {
      background: #ccc;
      border-radius: 10px;
      padding: 2px 8px;
      font-size: 12px;
    }
    .todo-item {
      margin-left: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 5px;
    }
    .todo-item label {
      flex: 1;
    }
  </style>
</head>
<body>
  <header>My Todo-list</header>

  <form action="/todos" method="POST">
    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
    <input type="text" name="title" placeholder="What's next?" required>
    <input type="date" name="dueDate" required>
    <button type="submit">Add</button>
  </form>

  <section>
    <h3>Overdue <span class="badge" id="count-overdue"><%= overdue.length %></span></h3>
    <% overdue.forEach(todo => { %>
      <div class="todo-item">
        <input type="checkbox" <%= todo.completed ? "checked" : "" %> onchange="toggleComplete(<%= todo.id %>, this.checked)">
        <label><%= todo.title %></label>
        <button onclick="deleteTodo(<%= todo.id %>)">Delete</button>
      </div>
    <% }) %>
  </section>

  <section>
    <h3>Due Today <span class="badge" id="count-due-today"><%= dueToday.length %></span></h3>
    <% dueToday.forEach(todo => { %>
      <div class="todo-item">
        <input type="checkbox" <%= todo.completed ? "checked" : "" %> onchange="toggleComplete(<%= todo.id %>, this.checked)">
        <label><%= todo.title %></label>
        <button onclick="deleteTodo(<%= todo.id %>)">Delete</button>
      </div>
    <% }) %>
  </section>

  <section>
    <h3>Due Later <span class="badge" id="count-due-later"><%= dueLater.length %></span></h3>
    <% dueLater.forEach(todo => { %>
      <div class="todo-item">
        <input type="checkbox" <%= todo.completed ? "checked" : "" %> onchange="toggleComplete(<%= todo.id %>, this.checked)">
        <label><%= todo.title %></label>
        <button onclick="deleteTodo(<%= todo.id %>)">Delete</button>
      </div>
    <% }) %>
  </section>

  <section>
    <h3>Completed items <span class="badge" id="count-completed"><%= completedItems.length %></span></h3>
    <% completedItems.forEach(todo => { %>
      <div class="todo-item">
        <input type="checkbox" checked onchange="toggleComplete(<%= todo.id %>, this.checked)">
        <label><%= todo.title %></label>
        <button onclick="deleteTodo(<%= todo.id %>)">Delete</button>
      </div>
    <% }) %>
  </section>

  <script>
    async function toggleComplete(id, completed) {
      await fetch(`/todos/${id}`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "X-CSRF-Token": "<%= csrfToken %>"
        },
        body: JSON.stringify({ completed })
      });
      window.location.reload();
    }

    async function deleteTodo(id) {
      await fetch(`/todos/${id}`, {
        method: "DELETE",
        headers: {
          "Content-Type": "application/json",
          "X-CSRF-Token": "<%= csrfToken %>"
        }
      });
      window.location.reload();
    }
  </script>
</body>
</html>
